var mvc=mvc||{};
jQuery.fn.ajaxForm=function(a){$(this).submit(function(c){a&&c.preventDefault();c=$(this);var b=mvc.request({data:c.mvcForm2Obj(),url:c.attr("action")+"Validate",dataType:"json"});if(b===undefined){mvc.ajaxFormRemove();return false}if(b.err===false){mvc.ajaxFormRemove();return true}if($("#form-error-shown").length>0)$("#form-error-shown").closest(".notice-item-wrapper").fadeOut("fast",function(){$(this).remove();b=mvc.flash_msg_format(b);mvc.ajaxFormAdd("",b.flash_msg,1,"error")});else{b=mvc.flash_msg_format(b);
mvc.ajaxFormAdd("",b.flash_msg,1,"error")}return false})};mvc.flash_msg_format=function(a){a.count=0;for(var c in a.errors_array)a.count++;a.plural=a.count>1?"s":"";a.flash_msg='<strong id="form-error-shown">Validation Error'+a.plural+"</strong><br/>"+a.errors;return a};mvc.ajaxFormRemove=function(){$("#form-error-shown").closest(".notice-item-wrapper").remove()};
mvc.ajaxFormAdd=function(a,c,b,d){b=b?b:1;d=d?d:"error";a=a!=""?'<strong id="form-error-shown">'+a+"</strong><br/>":"";$.noticeAdd({text:a+c,stay:b,type:d})};mvc.ajax={};mvc.ajax.options={type:"post",dataType:"",async:false,cache:false,timeout:3E3,data:{}};
jQuery.fn.mvcForm2Obj=function(a){a=a||{};jQuery.each(jQuery(this).serializeArray(),function(){if(a[this.name]){a[this.name].push||(a[this.name]=[a[this.name]]);a[this.name].push(this.value||"")}else a[this.name]=this.value||""});a["mvc[postselector]"]=this.selector;return a};mvc.redirect=function(a){window.location.replace(a)};
mvc.request=function(a){a=a||{};mvc.ajax.responds=undefined;mvc.ajax.jqxhr=undefined;mvc.ajax.textstatus=undefined;mvc.ajax.errorthrown=undefined;mvc.ajax.options.success=function(c){mvc.ajax.responds=c};mvc.ajax.options.error=function(c,b,d){mvc.ajax.jqxhr=c;mvc.ajax.textstatus=b;mvc.ajax.errorthrown=d};complete=jQuery.extend({},mvc.ajax.options,a);jQuery.ajax(complete);return mvc.ajax.responds};
mvc.basename=function(a,c){var b=a.replace(/^.*[\/\\]/g,"");if(typeof c=="string"&&b.substr(b.length-c.length)==c)b=b.substr(0,b.length-c.length);return b};mvc.dirname=function(a){return a.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"")};
